@page "/"

<PageTitle>Collabim Custom Search</PageTitle>

@using Collabim.CustomSearch.Business
@using Google.Apis.Customsearch.v1.Data
@inject ISearchService SearchService



<div class="@_cssClass">
   <SearchBox OnSearchClickevent="OnSearchClick"></SearchBox>
</div>

@if (_searchItems != null && _searchItems.Count > 0)
{
   <div>      
         @foreach (var item in _searchItems)
         {
            <div>
            @if (item.Pagemap != null && item.Pagemap.ContainsKey(""))
            {
               @*<div>@((MarkupString)item.Pagemap</div>*@
            }
               <div><a href="@((MarkupString)item.Link)" target="_blank">@((MarkupString)item.HtmlTitle)</a></div>
               <div>@((MarkupString)item.Link)</div>
               <div>@((MarkupString)item.HtmlSnippet)</div>              
            </div>
            <br />
         }      
   </div>
}

@code {

   private IList<Result> _searchItems;
   private string _cssClass = string.Empty;

   protected override async Task OnInitializedAsync()
   {
       SetCssClass();
   }  

   private async Task OnSearchClick(string searchText)
   {
      if (!string.IsNullOrWhiteSpace(searchText))
      {
         try
         {
            _searchItems = await SearchService.SearchAsync(searchText);
         }
         catch
         {
            // log
         }

         SetCssClass();
      }
   }

   private void SetCssClass()
   {
      if (_searchItems == null || _searchItems.Count == 0)
      {
         _cssClass = "d-flex align-items-center text-center vh-100";
      }
      else
      {
         _cssClass = "pt-5 ps-5 pb-5";
      }
   }
}

